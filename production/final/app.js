angular.module("DealersApp",["ngAnimate","ngRoute","ngCookies","ngMaterial","ui.bootstrap","ngImgCrop","angular-google-analytics"]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("purple",{default:"500"}).accentPalette("purple",{default:"500"})}]).config(["AnalyticsProvider",function(a){a.setAccount({tracker:"UA-62425106-3",trackEvent:!0,trackEcommerce:!0}),a.useECommerce(!0,!1),a.setCurrency("ILS"),a.readFromRoute(!0)}]).run(["$rootScope","$location","$cookies","$http","$timeout","$mdToast","DealerPhotos","Analytics",function(a,b,c,d,e,f,g,h){function i(b){a.INTERCOM_APP_ID="z1b3ijln",window.Intercom("boot",{app_id:a.INTERCOM_APP_ID,user_id:b.id,user_hash:b.intercom_code,name:b.full_name,email:b.email,date_of_birth:b.date_of_birth,gender:b.gender,about:b.about,location:b.location,role:b.role,rank:b.rank})}function j(){var b=a.dealer,c=a.dealer.photo;"None"!=c&&""!=c?(g.getPhoto(c,b.id,a.userProfilePicSender),a.$on("downloaded-"+a.userProfilePicSender+"-dealer-pic-"+b.id,function(b,c){c.success?e(function(){a.userProfilePic=c.data,a.$apply()},1e3):(a.userProfilePic=null,console.log(c.message))})):a.userProfilePic=g.DEFAULT_PROFILE_PIC}if(a.baseUrl="http://api.dealers-web.com",a.homeUrl="http://www.dealers-web.com",a.stripe_publishable_key="pk_test_q3cpGyBIL6rsGswSQbP3tMpK",a.AWSKey="AKIAIWJFJX72FWKD2LYQ",a.AWSSecretKey="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",a.AWSS3Bucket="dealers-app",a.directImageURlPrefix="https://"+a.AWSS3Bucket+".s3.amazonaws.com/",a.DEFAULT_PRODUCT_PHOTO_URL="assets/images/icons/@2x/Web_Icons_product_photo_placeholder.png",AWS.config.update({accessKeyId:a.AWSKey,secretAccessKey:a.AWSSecretKey}),AWS.config.region="eu-west-1",a.s3=new AWS.S3,a.setUserProfilePic=j,"[object Object]"!==c.get("globals")&&(a.globals=c.getObject("globals")||{},a.globals.currentUser)){d.defaults.headers.common.Authorization="Token "+a.globals.currentUser.token;var k=localStorage.getItem("dealer");k&&(a.dealer=JSON.parse(k),a.userProfilePic="",a.userProfilePicSender="user-dealer-pic",j(),i(a.dealer),a.$broadcast("DEALER_LOADED"))}a.roles={guest:"Guest",viewer:"Viewer",dealer:"Dealer",admin:"Admin"},a.categories=["Art","Automotive","Health & Beauty","Books & Magazines","Electronics","Entertainment & Events","Fashion","Food & Groceries","Home & Furniture","Kids & Babies","Music","Pets","Restaurants & Bars","Services","Sports & Outdoor","Travel","Other"],a.discountTypes={percentage:"PE",previousPrice:"PP"},a.showToast=function(a,b){var c=3e3;b&&(c=b),f.show(f.simple().textContent(a).position("top").hideDelay(c))},a.$on("$locationChangeStart",function(c,d,e){var f,g,h=a.roles;if(window.Intercom("update"),f=a.dealer?a.dealer.role:h.guest,f!=h.dealer){g=["/new-product","/edit-product"];for(var i=0;i<g.length;i++)if(d.indexOf(g[i])>-1)return void b.path("/")}if(f==h.dealer)for(g=["/register"],i=0;i<g.length;i++)if(d.indexOf(g[i])>-1)return void b.path("/")})}]),angular.module("DealersApp").config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"app/components/views/home.view.html",controller:"HomeController"}).when("/home",{templateUrl:"app/components/views/home.view.html",controller:"HomeController",pageTrack:"/home"}).when("/register",{templateUrl:"app/components/views/sign-in/register-as-dealer.view.html",controller:"RegisterAsDealerController",pageTrack:"/register-as-dealer"}).when("/search/products/:query",{templateUrl:"app/components/views/products/products-page.view.html",controller:"ProductsGridController",pageTrack:"/search/products"}).when("/categories",{templateUrl:"app/components/views/categories-list.view.html",controller:"CategoriesListController",pageTrack:"/categories"}).when("/categories/:category",{templateUrl:"app/components/views/products/products-page.view.html",controller:"ProductsGridController",pageTrack:"/categories"}).when("/products/:productID",{templateUrl:"app/components/views/view-deal.view.html",controller:"ViewDealController",pageTrack:"/product"}).when("/dealers/:dealerID",{templateUrl:"app/components/views/profile.view.html",controller:"ProfileController",pageTrack:"/profile"}).when("/edit-profile/:dealerID",{templateUrl:"app/components/views/edit-profile.view.html",controller:"EditProfileController",pageTrack:"/edit-profile"}).when("/new-product",{templateUrl:"app/components/views/products/add-product.view.html",controller:"AddProductController",pageTrack:"/add-product"}).when("/new-product/spread-the-word",{templateUrl:"app/components/views/products/add-product-finish.view.html",controller:"AddProductFinishController",pageTrack:"/add-product-finish"}).when("/edit-product/:productID",{templateUrl:"app/components/views/products/edit-product.view.html",controller:"EditProductController",pageTrack:"/edit-product"}).when("/done-registration",{templateUrl:"app/components/views/sign-in/done-registration.view.html"}).when("/products/:productID/checkout",{templateUrl:"app/components/views/checkout.view.html",controller:"CheckoutController",pageTrack:"/checkout"}).when("/products/:productID/checkout-finish",{templateUrl:"app/components/views/checkout-finish.view.html",controller:"CheckoutFinishController",pageTrack:"/checkout-finished"}).when("/purchase/:purchaseID",{templateUrl:"app/components/views/purchases/purchase-details.view.html",controller:"PurchaseDetailsController",pageTrack:"/purchase-details"}).when("/about",{templateUrl:"/app/components/views/about/about.view.html"}).when("/terms-and-privacy",{templateUrl:"app/components/views/about/terms-and-privacy.view.html"}).when("/contact",{templateUrl:"app/components/views/about/contact.view.html"}).when("/security",{templateUrl:"app/components/views/about/security.view.html"}).when("/help",{templateUrl:"app/components/views/about/help.view.html"}).when("/step-by-step",{templateUrl:"app/components/views/about/step-by-step.view.html"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("DealersApp").directive("intro",function(){return{restrict:"E",templateUrl:"app/components/views/about/intro-section.view.html",link:function(a,b){var c=$("nav.navbar"),d="navbar-shade";a.isHomePage&&a.role==a.roles.guest&&c.removeClass(d),$(window).scroll(function(){var a=$(window).scrollTop();a>=30?c.addClass(d):c.removeClass(d)}),a.$on("$destroy",function(){$(window).off("scroll")})}}}).directive("sellWithDealers",function(){return{restrict:"E",templateUrl:"app/components/views/about/sell-with-dealers.view.html"}}).directive("findOutMore",function(){return{templateUrl:"app/components/signed-out/shared/find-out-more.view.html",link:function(a,b){b.bind("click",function(a){var c=b.find("a");$("html, body").stop().animate({scrollTop:$(c.attr("href")).offset().top},1250,"easeInOutExpo"),a.preventDefault()})}}}).directive("aboutSection",function(){return{restrict:"E",templateUrl:"app/components/views/about/about-section.view.html"}}).directive("iosSection",function(){return{restrict:"E",templateUrl:"app/components/signed-out/shared/ios-section.view.html"}}).directive("footerSection",function(){return{restrict:"E",templateUrl:"app/components/views/about/footer-section.view.html"}}).directive("menuFooter",function(){return{restrict:"E",templateUrl:"app/components/views/about/menu-footer.view.html"}}),angular.module("DealersApp").factory("ActiveSession",["$http","$rootScope","$cookies",function(a,b,c){function d(a){i.actionsToRun.push(a)}function e(a){if($.inArray(a,i.actionsToRun)!=-1){var b=i.actionsToRun.indexOf(a);return i.actionsToRun.splice(b,1),!0}return!1}function f(a){return j[a]}function g(a,b){j[a]=b}function h(a){j.hasOwnProperty(a)&&delete j.key}var i={};i.actionsToRun=[];var j={};return i.getTempData=f,i.setTempData=g,i.removeTempData=h,i.addActionToRun=d,i.shouldRunAction=e,i}]),angular.module("DealersApp").controller("AddProductFinishController",["$scope","$rootScope","$location","$timeout","$mdDialog","AddProduct",function(a,b,c,d,e,f){function g(){a.product||c.path("/home")}b.baseUrl+"/products/";a.didntShare=!0,a.didShare=!1,a.product=f.getProduct(),g(),a.switchDidShare=function(b){d(function(){a.didntShare=!1},2e3),d(function(){a.didShare=!0},2500)},a.done=function(){return a.product&&a.product.id?void c.path("/products/"+a.product.id):void c.path("/home")},a.$on("$destroy",function(){f.clearSession()})}]),angular.module("DealersApp").controller("AddProductController",["$scope","$location","$timeout","$mdDialog","$mdConstant","AddProduct","Product","Photos","ProductPhotos","Analytics",function(a,b,c,d,e,f,g,h,i,j){function k(){l(),m()}function l(){var b=f.getProduct();$.isEmptyObject(b)||null==b?f.checkForSavedSessions()?a.product=g.unStringifyObject(f.getProduct()):a.product={}:a.product=g.unStringifyObject(b),a.product.currency="₪",a.product.max_quantity=J}function m(){if(a.product&&a.product.photos&&a.product.photos.length>0){a.photos=a.product.photos;for(var b=[],c=0;c<a.photos.length;c++)h.checkIfImageData(a.photos[c])||b.push(c);for(c=0;c<b.length;c++)a.photos.splice(b[c],1);a.photosURLs=h.imageDataToUrls(a.photos),a.selectPhoto(0)}}function n(b){a.selectedPhotoIndex=b,a.changeThumbnailSelection(b),a.shouldBeTabIndex=a.selectedTab,c(function(){$(".carousel-inner div").each(function(b){a.selectedPhotoIndex==b?$(this).addClass("active"):$(this).removeClass("active"),a.$apply()})},500)}function o(a){var b=$("div.carousel-inner"),c=b.children();return $(c[a]).hasClass("active")}function p(a){$("div.ap-thumbnail").removeClass("selected"),$("li#"+a+"-photo div.ap-thumbnail").addClass("selected")}function q(a,b,c){d.show(d.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a).textContent(b).ariaLabel("Alert Dialog").ok("Got it").targetEvent(c))}function r(a){d.show({templateUrl:"app/components/views/loading-dialog.view.html",parent:angular.element(document.body),targetEvent:a,controller:"LoadingDialogController",locals:{message:C},escapeToClose:!1})}function s(a){d.hide()}function t(b,c){return a.product.title?0!=a.photos.length||(q("Missing Images","Please add images of your product!",c),!1):(q("Title Is Blank","Please add a title for you product!",c),!1)}function u(b,c){return null==a.product.price?(q("Blank Price","Please add the price of your product!",c),!1):a.product.price<=0?(q("Not a Valid Price","Please enter a valid price.",c),!1):a.product.percentage_off<0?(q("Not a Valid Discount","Please enter a valid discount (not required).",c),!1):a.product.percentage_off>100?(q("Not a Valid Discount","You entered a discount of more than 100%!",c),!1):(a.product.original_price<=a.product.price&&q("Not a Valid Discount","The original price must be greater than the current price.",c),null==a.product.category?(q("Blank Category","Please add a category to which your product relates.",c),!1):0==a.product.category.length?(q("Blank Category","Please add a category to which your product relates.",c),!1):!(a.product.max_quantity<=0||a.product.max_quantity>1e4)||(q("Not a Valid Max Quantity Value","Please add a valid quantity.",c),!1))}function v(){return a.showDiscount?(a.product.percentage_off&&!a.presentPercentageOff&&(a.product.percentage_off=null),void(a.product.original_price&&!a.presentOriginalPrice&&(a.product.original_price=null))):(a.product.percentage_off=null,void(a.product.original_price=null))}function w(){for(var b in a.variants)if(a.variants.hasOwnProperty(b)){var c=a.variants[b].name;if(!(c.length>0)){delete a.variants[b];continue}for(var d=a.variants[b].options,e=d.length-1;e>=0;e--)0==d[e].length&&d.splice(e,1)}}var x="The content will be lost.",y=0,z=1,A="Next",B="Upload Product",C="Loading",D="apSession",E="Add Discount",F="Remove Discount",G="photos-downloaded-for-",H="ap-upload-finished",I="/new-product/spread-the-word",J=30;a.photos=[],a.photosURLs=[],a.selectedPhotoIndex=0,a.addPhotoText="Add Image",a.submitButtonTitle=A,a.showDiscount=!1,a.showDiscountTitle=E,a.variants={},a.maxVariants=3,a.variations=[],a.keys=[e.KEY_CODE.ENTER,e.KEY_CODE.COMMA,e.KEY_CODE.TAB],a.placeholderNames=["e.g. Color","e.g. Size","e.g. Material"],a.placeholderOptions=["Red, Blue","S, M, L, XL","Silk, Cotton"],a.shouldBeTabIndex=-1,a.selectPhoto=n,a.changeThumbnailSelection=p,a.checkIfActive=o,a.showAlertDialog=q,k(),a.nextPhoto=function(b){var c;c="A"==b.target.tagName?b.target:b.target.parentElement;var d,e=a.photos.length;a.checkIfActive(a.selectedPhotoIndex)&&($(c).hasClass("left")?(d=a.selectedPhotoIndex-1,d<0&&(d=e-1)):$(c).hasClass("right")&&(d=a.selectedPhotoIndex+1,d>=e&&(d=0)),a.selectedPhotoIndex=d,a.changeThumbnailSelection(d))},a.$watchGroup(["photos[0]","photos[1]","photos[2]","photos[3]"],function(b,c){for(var d=0;d<b.length;d++)null!=b[d]&&null==c[d]&&a.selectPhoto(d)}),a.removePhoto=function(b){var c=d.confirm().title("Remove Photo").textContent("Are you sure you want to remove this photo?").ariaLabel("Remove photo").targetEvent(b).ok("Yes").cancel("Cancel");d.show(c).then(function(){var c=b.target.parentElement.parentElement.id;c=parseInt(c,10),a.photos.splice(c,1),a.photosURLs.splice(c,1)})},a.openMenu=function(a,b){a(b)},a.presentDiscountControllers=function(b){a.showDiscount?(a.showDiscount=!1,a.showDiscountTitle=E):(a.showDiscount=!0,a.showDiscountTitle=F)},a.changePrice=function(b){a.product.percentage_off>0&&a.changePercentageOff(b)},a.changePercentageOff=function(b){if(a.product.percentage_off){var c=100-a.product.percentage_off;c<=0?(a.product.price=0,a.product.original_price=null):a.product.original_price=a.product.price/c*100}},a.changeOriginalPrice=function(b){var c=100*(1-a.product.price/a.product.original_price);a.product.percentage_off=Math.round(100*c)/100},a.getVariantsLength=function(){return Object.keys(a.variants).length},a.addVariant=function(b){a.getVariantsLength()<a.maxVariants&&(a.variants[a.getVariantsLength()]={name:"",options:[]})},a.removeVariant=function(b,c){for(delete a.variants[b];a.variants[b+1];)a.variants[b]=a.variants[b+1],delete a.variants[b+1],b++},a.onTabSelected=function(b){0==b?a.submitButtonTitle=A:a.submitButtonTitle=B},a.addProduct=function(b,c){return a.selectedTab==y?(a.selectedTab=z,void $("html, body").animate({scrollTop:0},800)):void(t(b,c)&&u(b,c)&&(v(),$.isEmptyObject(a.variants)||(w(),a.product.variants=g.parseVariantsToServer(a.variants)),a.product.photos=a.photos,a.product.max_quantity=Math.round(a.product.max_quantity),r(),i.uploadPhotosOfProduct(a.product,D)))},a.$on(G+D,function(b,c){c.data;c.success?(a.product=c.product,f.uploadProduct(a.product),j.trackEvent("Product","add",a.product.category)):(s(b),console.log("Couldn't upload the photos. Aborting upload process."))}),a.$on(H,function(a,c){s(),c.success?b.path(I):(console.log(c.message),q("We're sorry, but there was a problem",c.message,a))}),window.onbeforeunload=function(){if(f.saveSession(a.product,a.photosURLs),a.photos.length>0||!$.isEmptyObject(a.product))return x};a.$on("$locationChangeStart",function(b,c){var d="new-product";if(c.indexOf(d)==-1&&(0!=a.photos.length||a.addProductForm.$dirty)){var e=confirm("Are you sure you want to leave this page? This process will be lost.");if(!e)return void b.preventDefault();f.clearSession()}});a.$on("$destroy",function(){window.onbeforeunload=null})}]),angular.module("DealersApp").factory("AddProduct",["$http","$rootScope","Product","ProductPhotos",function(a,b,c,d){function e(){return q.product}function f(a){q.product=a}function g(a,b){if(a){var d=$.extend({},a);d=c.removePhotoPaths(d),d=c.extractData(d),"string"==typeof d.price&&(d.price=parseFloat(d.price));try{localStorage.setItem(m,JSON.stringify(d))}catch(a){console.log("Couldn't save product's data: "+a)}}else console.log("No product to save to the local storage.")}function h(){var a=localStorage.getItem(m);if(a){if(q.product=JSON.parse(a),q.product.category&&2==q.product.category.length&&(q.product.category=c.categoryForKey(q.product.category)),q.product.expiration){var b=Date.parse(q.product.expiration);q.product.expiration=new Date(b)}return!0}return!1}function i(){q.product={},q.savedPhotosURLs=[],localStorage.removeItem(m),localStorage.removeItem(n)}function j(a){q.product=a,g(a),k()}function k(){q.product.dealer=b.dealer.id,q.product.currency=c.keyForCurrency(q.product.currency),q.product.discount_value&&q.product.discount_value>0?q.product.discount_type=c.keyForDiscountType(q.product.discount_type):(q.product.discount_value=null,q.product.discount_type=null),q.product.category=c.keyForCategory(q.product.category),q.product.upload_date=new Date,q.product.store={},q.product.dealattribs={};var a=new Image;a.onload=function(){q.product.main_photo_width=this.width,q.product.main_photo_height=this.height,l()},a.src=URL.createObjectURL(q.product.photos[0])}function l(){var d=c.extractData(q.product);a.post(b.baseUrl+o,d).then(function(a){console.log("Product uploaded successfully!"),f(a.data),b.$broadcast(p,{success:!0,message:null})},function(a){console.log("There was an error while uploading the product: "+a.data),b.$broadcast(p,{success:!1,message:a.data})})}var m="apSession",n="apSessionPhotos",o="/adddeals/",p="ap-upload-finished",q={};return q.product={},q.savedPhotosURLs=[],q.getProduct=e,q.setProduct=f,q.saveSession=g,q.checkForSavedSessions=h,q.clearSession=i,q.uploadProduct=j,q}]),angular.module("DealersApp").factory("Authentication",["$http","$rootScope","$cookies",function(a,b,c){function d(a,b){var c=h(a+":"+b);return"Basic "+c}function e(c,d){return a.post(b.baseUrl+"/dealers-token-auth/",{username:c,password:d})}function f(d,e){b.globals={currentUser:{username:d,token:e}},a.defaults.headers.common.Authorization="Token "+e,c.putObject("globals",b.globals)}function g(){b.globals={},a.defaults.headers.common.Authorization=null,c.remove("globals")}function h(a){var b,c,d,e,f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",i="",j="",k=0;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),i=a.charCodeAt(k++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|i>>6,j=63&i,isNaN(c)?f=j=64:isNaN(i)&&(j=64),h=h+g.charAt(d)+g.charAt(e)+g.charAt(f)+g.charAt(j),b=c=i="",d=e=f=j="";while(k<a.length);return h}var i={};return i.getCredentials=d,i.getToken=e,i.saveCredentials=f,i.clearCredentials=g,i}]),angular.module("DealersApp").controller("CategoriesListController",["$scope",function(a){a.elements=a.categories}]),angular.module("DealersApp").controller("CheckoutFinishController",["$scope","$rootScope","$location","$mdDialog","ActiveSession",function(a,b,c,d,e){function f(){a.product||c.path("/home")}a.product=e.getTempData("PRODUCT"),f(),a.done=function(){c.path("/home")},a.$on("$destroy",function(){e.removeTempData("PRODUCT")})}]),angular.module("DealersApp").controller("CheckoutController",["$scope","$rootScope","$routeParams","$location","$mdMedia","$mdDialog","Checkout","ActiveSession","Product","ProductPhotos","Purchase",function(a,b,c,d,e,f,g,h,i,j,k){function l(){a.product=h.getTempData("PRODUCT"),a.$watch(function(){return e("(max-width: 722px)")},function(b){a.smallSize=b}),a.product?(a.status=p,n(),o()):m()}function m(){var b=c.productID;i.getProduct(b).then(function(b){a.status=p,a.product=b.data,a.product=i.mapData(a.product),a.product.max_quantity>0||(a.product.max_quantity=30),n(),o()},function(b){a.status=r,a.errorMessage="Couldn't download the product",a.errorPrompt="Please try again..."})}function n(){var c=g.purchase;c&&!$.isEmptyObject(c)||(c=g.retrieveSavedSession(),c&&!$.isEmptyObject(c)||(console.log("No purchase object!"),d.path("/products/"+a.product.id))),a.purchase={buyer:b.dealer.id,dealer:a.product.dealer.id,deal:a.product.id,amount:100*a.product.price,currency:a.product.currency,status:"Purchased",quantity:c.quantity,selections:c.selections}}function o(){a.product.photo?(a.productImage=a.product.photo,a.productImageStatus=p):(j.downloadPhoto(a.product.photo1,a.product.id),a.productImageStatus=q,a.$on("downloaded-photo-"+a.product.id,function(b,c){c.success?(a.productImage=c.data.url,a.product.photo=a.productImage,a.productImageStatus=p,a.$apply()):console.log(c.data.message)}))}var p="downloaded",q="downloading",r="failed";a.status=q,a.finished=!1;var s=b.dealer.shipping_address;a.shipping_address=s?s:{},l(),a.checkout=function(c,e){if(!c.$valid)return a.purchase.quantity?void f.show(f.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("Invalid Shipping Address").textContent("Please fill correctly all your shipping address information.").ariaLabel("Alert Dialog").ok("Got it").targetEvent(e)):void f.show(f.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("Invalid Quantity").textContent("The maximum quantity available is "+a.product.max_quantity+".").ariaLabel("Alert Dialog").ok("Got it").targetEvent(e));var g,j=a.product.price*a.purchase.quantity*100,l=b.directImageURlPrefix+a.product.dealer.photo;g=1==a.product.currency.length?i.keyForCurrency(a.product.currency):a.product.currency,a.purchase.shipping_address=a.shipping_address,a.purchase.currency=g;var m=StripeCheckout.configure({key:b.stripe_publishable_key,image:l,locale:"auto",email:b.dealer.email,token:function(c){var e={token:c.id,amount:j,currency:g,dealer:a.product.dealer.id,buyer:b.dealer.id};i.buyProduct(e).then(function(b){console.log("Payment successful!"),a.finished=!0,k.addPurchase(a.purchase,a.product),h.setTempData("PRODUCT",a.product),d.path("/products/"+a.product.id+"/checkout-finish")},function(a){console.log("Error!\n"+a)})}});m.open({name:a.product.title,description:a.product.dealer.full_name,amount:j,currency:g}),event&&event.preventDefault()},window.onbeforeunload=function(){g.saveSession(a.purchase)};a.$on("$locationChangeStart",function(){a.finished?g.clearSession():g.saveSession(a.purchase)});a.$on("$destroy",function(){g.clearSession()})}]),angular.module("DealersApp").factory("Checkout",["$http","$rootScope","Product","ProductPhotos",function(a,b,c,d){function e(a){if(a){i.purchase=a;try{localStorage.setItem(h,JSON.stringify(a))}catch(a){console.log("Couldn't save product's data: "+a)}}else console.log("No product to save to the local storage.")}function f(){var a=localStorage.getItem(h);return a?(i.purchase=JSON.parse(a),i.purchase):null}function g(){i.product={},localStorage.removeItem(h)}var h="coSession",i={};return i.product={},i.purchase={},i.saveSession=e,i.retrieveSavedSession=f,i.clearSession=g,i}]),angular.module("DealersApp").controller("CropPhotoDialog",["$scope","$rootScope","$mdDialog","rawPhoto",function(a,b,c,d){a.rawPhotoURL=d,a.croppedPhotoURL="",a.crop=function(){c.hide(a.croppedPhotoURL)},a.cancel=function(){c.cancel()}}]),angular.module("DealersApp").factory("DealerPhotos",["$rootScope",function(a){function b(a){return a.length>2&&"None"!=a}function c(b,c,d){a.s3.getObject({Bucket:a.AWSS3Bucket,Key:b,ResponseContentType:"image/jpg"},function(b,e){var f;if(null!=b)f="Failed to download dealer's dealer pic"+c+":"+b.message,a.$broadcast("downloaded-"+d+"-dealer-pic-"+c,{success:!1,message:f});else{f="Downloaded dealer's dealer pic successfully!";var g=new Blob([e.Body],{type:"image/png"}),h=URL.createObjectURL(g);a.$broadcast("downloaded-"+d+"-dealer-pic-"+c,{success:!0,data:h})}})}function d(b,c){var d=e(),h={Bucket:a.AWSS3Bucket,Key:f+d,Body:b};a.s3.putObject(h,function(b,e){b?(console.log("There was an error with s3 config: "+b.message),a.$broadcast(g+c,{success:!1,data:b.message})):(console.log("Profile pic upload complete."),a.dealer.photo=f+d,a.$broadcast(g+c,{success:!0,data:e}))})}function e(){var b=String(a.dealer.id),c=new Date,d=String(c.getTime()/1e3);return b+"_"+d+"_dealer.png"}var f="media/Profile_Photos/",g="dealer-pic-uploaded-for-",h={};return h.DEFAULT_PROFILE_PIC="assets/images/icons/@2x/default_profile_pic.png",h.hasProfilePic=b,h.getPhoto=c,h.uploadPhoto=d,h}]),angular.module("DealersApp").factory("Dealer",["$http","$rootScope","Authentication",function(a,b,c){function d(b){var d=b.user.password,e=c.getCredentials(s,t);a.post(w,b,{headers:{Authorization:e}}).then(function(a){var b=a.data;x.saveCurrent(b),x.setCredentials(b.user.username,d),x.broadcastResult("sign-up",!0,b)},function(a){x.broadcastResult("sign-up",!1,a)})}function e(d,e){var f=c.getCredentials(d,e);a.get(b.baseUrl+"/dealerlogins/",{headers:{Authorization:f}}).then(function(a){var b=a.data.results[0];x.saveCurrent(b),x.setCredentials(d,e),x.broadcastResult("log-in",!0,b)},function(a){x.broadcastResult("log-in",!1,a)})}function f(){c.clearCredentials(),localStorage.clear(),q(),b.dealer=null}function g(a){a&&(localStorage.setItem("dealer",JSON.stringify(a)),b.dealer=a)}function h(a,b){c.getToken(a,b).then(function(b){console.log("Set credentials successfully! Get in!"),c.saveCredentials(a,b.data.token),x.broadcastResult("credentials-set",!0)},function(a){console.log("Couldn't get token:"+a),x.broadcastResult("credentials-set",!1)})}function i(a,c,d){b.$broadcast(a,{success:c,message:d})}function j(b){return a.get(w+b+"/")}function k(c){return a.get(b.baseUrl+"/dealershorts/"+c+"/")}function l(c,d){a.post(b.baseUrl+"/bank_accounts/",c).then(function(c){b.dealer.role=b.roles.dealer;var e=o(b.dealer);a.patch(w+e.id+"/",e,{params:{mode:"new"}}).then(function(a){var b=a.data;x.saveCurrent(b),i(u+d,!0,b)},function(a){i(u+d,!1,a)})},function(a){i(u+d,!1,a)})}function m(c,d,e){a.patch(b.baseUrl+"/bank_accounts/"+c.id+"/",c).then(function(b){console.log("Updated the bank account information successfully. Now update the the dealer's information."),d=o(d),a.patch(w+d.id+"/",d,{params:{mode:"edit"}}).then(function(a){d=a.data,x.saveCurrent(d),i(v+e,!0,d)},function(a){i(v+e,!1,a)})},function(a){i(v+e,!1,a)})}function n(b,c){b=o(b),a.patch(w+b.id+"/",b,{params:{mode:"edit"}}).then(function(a){b=a.data,x.saveCurrent(b),i(v+c,!0,b)},function(a){i(v+c,!1,a)})}function o(a){var b=$.extend({},a);return b.hasOwnProperty("bank_accounts")&&delete b.bank_accounts,b.hasOwnProperty("screen_counters")&&delete b.screen_counters,b.hasOwnProperty("uploaded_deals")&&delete b.uploaded_deals,b.hasOwnProperty("liked_deals")&&delete b.liked_deals,b}function p(a){var c=new Date(a.register_date);window.Intercom("update",{app_id:b.INTERCOM_APP_ID,user_id:a.id,user_hash:a.intercom_code,name:a.full_name,email:a.email,date_of_birth:a.date_of_birth,gender:a.gender,about:a.about,location:a.location,role:a.role,rank:a.rank,created_at:c.getTime()})}function q(){window.Intercom("shutdown")}function r(c){var d={shipping_address:c};return a.patch(w+b.dealer.id,d)}var s="ubuntu",t="090909deal",u="register-as-dealer-for-",v="update-as-dealer-for-",w=b.baseUrl+"/dealers/";this.saveCurrent=g,this.setCredentials=h,this.broadcastResult=i;var x=this,y={};return y.create=d,y.logIn=e,y.logOut=f,y.getDealer=j,y.getShortDealer=k,y.registerDealer=l,y.updateDealer=m,y.updateViewer=n,y.setIntercom=p,y.updateShippingAddress=r,y}]),angular.module("DealersApp").factory("Dialogs",["$rootScope","$mdDialog","$mdMedia",function(a,b,c){function d(a,c){return b.show({controller:"SignInDialogController",templateUrl:"app/components/views/sign-in/sign-in-dialog-old.view.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:g,locals:{tab:c}})}function e(a,c,d,e){return b.confirm(e).parent(angular.element(document.body)).clickOutsideToClose(!1).title(a).textContent(c).ariaLabel("Confirm Dialog").ok(d).cancel("Cancel").targetEvent(e)}var f={},g=c("xs");return f.showSignInDialog=d,f.confirmDialog=e,f}]),angular.module("DealersApp").controller("EditProductController",["$scope","$rootScope","$location","$mdDialog","$mdConstant","$mdToast","$routeParams","$timeout","Product","ProductPhotos","EditProduct",function(a,b,c,d,e,f,g,h,i,j,k){function l(){var b=g.productID;i.getProduct(b).then(function(b){m(b.data),a.setProductInView(),a.variants=i.parseVariantsFromServer(a.product.variants)},function(b){a.status="failed",a.errorMessage="Couldn't download the product",a.errorPrompt="Please try again..."})}function m(b){b?(a.status="downloaded",a.originalDealer=i.mapData(b),a.product=$.extend({},a.originalDealer)):console.log("Something is wrong - setProduct called but there's no product!")}function n(b){if(a.product.percentage_off){var c=100-a.product.percentage_off;c<=0?(a.product.price=0,a.product.original_price=null):a.product.original_price=a.product.price/c*100}}function o(b){var c=100*(1-a.product.price/a.product.original_price);a.product.percentage_off=Math.round(100*c)/100}function p(){a.presentPercentageOff=!!a.product.percentage_off,a.presentOriginalPrice=!!a.product.original_price,a.changePercentageOff(),a.changeOriginalPrice(),s(),r()}function q(){if(a.product&&a.product.photos&&a.product.photos.length>0){a.photos=a.product.photos;for(var b=[],c=0;c<a.photos.length;c++)Photos.checkIfImageData(a.photos[c])||b.push(c);for(c=0;c<b.length;c++)a.photos.splice(b[c],1);a.photosURLs=Photos.imageDataToUrls(a.photos),a.selectPhoto(0)}}function r(){j.downloadPhotos(a.product);for(var c=0;c<j.photosNum(a.product);c++)a.photosStatus.push("loading"),a.photosURLs.push(b.DEFAULT_PRODUCT_PHOTO_URL);a.selectPhoto(0),a.$on("downloaded-photo-"+a.product.id,function(b,c){var d=c.data,e=d.photoIndex-1;c.success?(a.photos[e]=d.rawImage,a.photosURLs[e]=d.url,a.photosStatus[e]="doneLoading",a.$apply()):(console.log("Photos number "+d.photoIndex+" failed to download: \n"+d.message),a.photosStatus[e]="failed")})}function s(){var b=a.product;b&&(a.currency=b.currency,a.category=b.category)}function t(b){a.selectedIndex=b,a.changeThumbnailSelection(b),h(function(){$(".carousel-inner div").each(function(b){a.selectedIndex==b?$(this).addClass("active"):$(this).removeClass("active")})},500)}function u(a){var b=$("div.carousel-inner"),c=b.children();return $(c[a]).hasClass("active")}function v(a){$("div.ap-thumbnail").removeClass("selected"),$("li#"+a+"-photo div.ap-thumbnail").addClass("selected")}function w(a,b,c){d.show(d.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a).textContent(b).ariaLabel("Alert Dialog").ok("Got it").targetEvent(c))}function x(a){d.show({templateUrl:"app/components/views/loading-dialog.view.html",parent:angular.element(document.body),targetEvent:a,controller:"LoadingDialogController",locals:{message:J},escapeToClose:!1})}function y(a){d.hide()}function z(){a.product.percentage_off&&!a.presentPercentageOff&&(a.product.percentage_off=null),a.product.original_price&&!a.presentOriginalPrice&&(a.product.original_price=null)}function A(){for(var b in a.variants)if(a.variants.hasOwnProperty(b)){var c=a.variants[b].name;if(!(c.length>0)){delete a.variants[b];continue}for(var d=a.variants[b].options,e=d.length-1;e>=0;e--)0==d[e].length&&d.splice(e,1)}}function B(){k.deleteVariants(a.product.variants),delete a.product.variants;for(var b=i.parseVariantsToServer(a.variants),c=[],d=0;d<b.length;d++)b[d].deal=a.product.id,k.postVariant(b[d]).then(function(d){c.push(d.data),c.length==b.length&&(a.variantsForLater=c,a.uploadPhotosAndProduct())},function(a){console.log("Failed to post variant.")});0==b.length&&a.uploadPhotosAndProduct()}function C(b,c){return 0==a.photos.length?(w("Missing Photos","You must add photos of your product!",c),!1):a.product.title?null==a.product.price?(w("Blank Price","Please add the price of your product!",c),!1):a.product.price<=0?(w("Not a Valid Price","Please enter a valid price.",c),!1):a.product.percentage_off<0?(w("Not a Valid Discount","Please enter a valid discount (not required).",c),!1):a.product.percentage_off>100?(w("Not a Valid Discount","You entered a discount of more than 100%!",c),!1):a.product.original_price<=a.product.price?(w("Not a Valid Discount","The original price must be greater than the current price.",c),!1):a.product.max_quantity>0?null==a.product.category?(w("Blank Category","Please add a category to which your product relates.",c),!1):0!=a.product.category.length||(w("Blank Category","Please add a category to which your product relates.",c),!1):(w("Not a Valid Max Quantity Value","Please add a valid quantity.",c),!1):(w("Title Is Blank","You must add a title for you product!",c),!1)}var D="₪",E="$",F="€",G="%",H="The changes you made will be lost.",I="/products/"+g.productID+"/",J="Saving changes...",K="photos-downloaded-for-",L="ep-upload-started",M="ep-upload-finished",N="epSession",O="Changes Saved!",P=b.baseUrl+"/alldeals/"+g.productID+"/";
a.originalDealer={},a.product={},a.currency=D,a.discountType=G,a.category="",a.minDate=new Date,a.changedPhotos=!1,a.savedChanges=!1,a.photos=[],a.photosStatus=[],a.photosURLs=[],a.oldPhotosURLs=[],a.selectedIndex=0,a.addPhotoText="Add a Photo",a.variants={},a.maxVariants=3,a.variations=[],a.keys=[e.KEY_CODE.ENTER,e.KEY_CODE.COMMA,e.KEY_CODE.TAB],a.placeholderNames=["e.g. Color","e.g. Size","e.g. Material"],a.placeholderOptions=["Red, Blue","S, M, L, XL","Silk, Cotton"],a.selectPhoto=t,a.changeThumbnailSelection=v,a.checkIfActive=u,a.changePercentageOff=n,a.changeOriginalPrice=o,a.setProductInView=p,k.product.id?(m(k.product),a.setProductInView(),a.variants=i.parseVariantsFromServer(a.product.variants)):(a.status="loading",l(),q()),a.changePrice=function(b){a.product.percentage_off>0&&a.changePercentageOff(b)},a.changePresentPercentageOff=function(b){a.presentPercentageOff=!a.presentPercentageOff},a.changePresentOriginalPrice=function(b){a.presentOriginalPrice=!a.presentOriginalPrice},a.nextPhoto=function(b){var c;c="A"==b.target.tagName?b.target:b.target.parentElement;var d,e=a.photos.length;a.checkIfActive(a.selectedIndex)&&($(c).hasClass("left")?(d=a.selectedIndex-1,d<0&&(d=e-1)):$(c).hasClass("right")&&(d=a.selectedIndex+1,d>=e&&(d=0)),a.selectedIndex=d,a.changeThumbnailSelection(d))},a.$watchGroup(["photos[0]","photos[1]","photos[2]","photos[3]"],function(b,c){for(var d=0;d<b.length;d++)null!=b[d]&&null==c[d]&&a.selectPhoto(d)}),a.removePhoto=function(b){var c=d.confirm().title("Remove Photo").textContent("Are you sure you want to remove this photo?").ariaLabel("Remove photo").targetEvent(b).ok("Yes").cancel("Cancel");d.show(c).then(function(){var c=b.target.parentElement.parentElement.id;c=parseInt(c,10),a.photos.splice(c,1),a.photosURLs.splice(c,1),a.changedPhotos=!0})},a.openMenu=function(a,b){a(b)},a.changedPhoto=function(b){a.changedPhotos=!0},a.shekel=function(){a.currency=D},a.dollar=function(){a.currency=E},a.euro=function(){a.currency=F},a.getVariantsLength=function(){return Object.keys(a.variants).length},a.addVariant=function(b){a.getVariantsLength()<a.maxVariants&&(a.variants[a.getVariantsLength()]={name:"",options:[]})},a.removeVariant=function(b,c){for(delete a.variants[b];a.variants[b+1];)a.variants[b]=a.variants[b+1],delete a.variants[b+1],b++},a.$on(L,function(a){x(a)}),a.$on(M,function(d,e){y(),e.success?(a.savedChanges=!0,e.data&&(a.product=e.data,a.product.variants=a.variantsForLater,k.product=a.product),c.path(I),h(b.showToast,1500,!0,O)):(console.log(e.message),w("We're sorry, but there was a problem",e.message,d))}),a.submitEdit=function(b){a.product.photos=a.photos,C(b,event)&&(z(),a.product.photos=a.photos,a.product.max_quantity=Math.round(a.product.max_quantity),x(),$.isEmptyObject(a.variants)?(delete a.product.variants,a.uploadPhotosAndProduct()):(A(),B()))},a.uploadPhotosAndProduct=function(){a.changedPhotos?(a.oldPhotosURLs=j.setProductPhotosInArray(a.product),j.uploadPhotosOfProduct(a.product,N)):k.uploadModifiedProduct(a.product)},a.$on(K+N,function(b,c){c.data;c.success?(a.product=c.product,k.uploadModifiedProduct(a.product),a.oldPhotosURLs&&j.deletePhotos(a.oldPhotosURLs)):(y(b),console.log("Couldn't upload the photos. Aborting upload process."))}),a.deleteProduct=function(a){var e=d.confirm().title("Delete Product").textContent("Are you absolutely sure that you want to delete this product? It cannot be undone!").ariaLabel("Delete product").targetEvent(a).ok("Yes, delete this product").cancel("Cancel");d.show(e).then(function(){i.deleteProduct(P).then(function(a){console.log("Product deleted successfully."),h(b.showToast,1e3,!0,"Deleted the product."),c.path("/home")},function(a){console.log(a.status+" : "+a.data),d.show(d.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("Couldn't delete the product").textContent("Please try again!").ariaLabel("Alert Dialog").ok("OK").targetEvent(ev))})})},window.onbeforeunload=function(){return H},a.$on("$locationChangeStart",function(b,c){if(!a.savedChanges){var d=confirm("Are you sure you want to leave this page? The changes will be lost.");d||b.preventDefault()}}),a.$on("$destroy",function(){k.product=null,window.onbeforeunload=null})}]),angular.module("DealersApp").factory("EditProduct",["$http","$rootScope","$routeParams","Product","ProductPhotos",function(a,b,c,d,e){function f(a){m.product=a,g();var b=new Image;b.onload=function(){m.product.main_photo_width=this.width,m.product.main_photo_height=this.height,h()},b.src=URL.createObjectURL(m.product.photos[0])}function g(){m.product.currency=d.keyForCurrency(m.product.currency),m.product.discount_value&&m.product.discount_value>0?m.product.discount_type=d.keyForDiscountType(m.product.discount_type):(m.product.discount_value=null,m.product.discount_type=null),m.product.dealer=m.product.dealer.id,m.product.category=d.keyForCategory(m.product.category)}function h(){var c=d.extractData(m.product);a.patch(b.baseUrl+l+m.product.id+"/",c).then(function(a){console.log("Product uploaded successfully!"),b.$broadcast(k,{success:!0,data:a.data})},function(a){console.log("There was an error while uploading the product: "+a.data),b.$broadcast(k,{success:!1,message:a.data})})}function i(c){for(var d=0;d<c.length;d++){var e=c[d].id;e&&a.delete(b.baseUrl+"/variants/"+e+"/").then(function(a){},function(a){console.log("Failed to delete variant.")})}}function j(c){return a.post(b.baseUrl+"/variants/",c)}var k="ep-upload-finished",l="/adddeals/",m={};return m.product={},m.savedPhotosURLs=[],m.uploadModifiedProduct=f,m.deleteVariants=i,m.postVariant=j,m}]),angular.module("DealersApp").controller("EditProfileController",["$scope","$rootScope","$location","$mdDialog","$mdMedia","$mdToast","$routeParams","$timeout","Dealer","Photos","DealerPhotos",function(a,b,c,d,e,f,g,h,i,j,k){function l(){return q(),a.profile=$.extend(!0,{},b.dealer),a.profile&&a.profile.id?void n():void m()}function m(){i.getDealer(a.dealerID).then(function(b){a.profile=b.data,n()},function(b){a.status=B,console.log("The dealer information was absent and couldn't download it from the server.")})}function n(){a.status=A,a.bank_account=a.profile.bank_accounts[a.profile.bank_accounts.length-1],o(),p(),a.userMode==G&&(a.datepicker={opened:!1,options:{formatYear:"yyyy",maxDate:new Date,showWeeks:!1,initDate:new Date(a.profile.date_of_birth)}})}function o(){a.profile.role==a.roles.dealer&&(a.userMode=F)}function p(){if(b.userProfilePic)return a.photoURL=b.userProfilePic,void(a.croppedPhotoURL=b.userProfilePic);a.profilePicStatus=z,a.hasProfilePic=k.hasProfilePic(a.profile.photo);var c="dealer";a.hasProfilePic&&(k.getPhoto(a.profile.photo,a.profile.id,c),a.profilePicStatus=z),a.$on("downloaded-"+c+"-dealer-pic-"+a.profile.id,function(b,c){c.success?a.$apply(function(){a.croppedPhotoURL=c.data,a.profilePicStatus=A}):(a.profilePicStatus=B,console.log(c.message))})}function q(){a.$on(K+E,function(c,d){d.success?(a.profile.photo=b.dealer.photo,b.userProfilePic=a.croppedPhotoURL,y()):(t(c),console.log("Couldn't upload the dealer pic. Aborting upload process."))}),a.$on(L+E,function(b,d){d.success?(console.log("Dealer was updated successfully!"),window.onbeforeunload=null,a.editingDone=!0,t(),c.path("/dealers/"+a.dealerID)):(t(b),d.message.data&&d.message.data.account_number[0]?r("Account number duplicate","The account number you entered already exists. Please check your input again.",b):r("There was a problem...","We're sorry, please try again!",b))}),a.$watch("photoURL",function(){a.photoURL&&a.photoURL.length>0&&a.photoURL!=b.userProfilePic&&(a.changedPhoto=!0,a.showCropDialog())}),a.$watch("croppedPhotoURL",function(){a.croppedPhotoURL==H?a.editProfilePic=I:a.editProfilePic=J})}function r(a,b,c){d.show(d.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a).textContent(b).ariaLabel("Alert Dialog").ok("Got it").targetEvent(c))}function s(a){d.show({templateUrl:"app/components/views/loading-dialog.view.html",parent:angular.element(document.body),targetEvent:a,controller:"LoadingDialogController",locals:{message:D},escapeToClose:!1})}function t(a){d.hide()}function u(){a.photo="",a.photoURL=""}function v(b){return!!a.profile.full_name||(r("The name field is blank","This field is required.",b),!1)}function w(b){return a.profile.full_name?a.profile.about?!!a.profile.location||(r("Location field is blank","This field is required.",b),!1):(r("About field is blank","This field is required.",b),!1):(r("The name field is blank","This field is required.",b),!1)}function x(b){return a.bank_account.account_number?a.bank_account.branch_number?a.bank_account.bank?!!a.bank_account.account_holder||(r("Account holder name is blank","This field is required.",b),!1):(r("The bank field is blank","This field is required.",b),!1):(r("Branch number is blank","This field is required.",b),!1):(r("Account number is blank","This field is required.",b),!1)}function y(){a.userMode==G?i.updateViewer(a.profile,E):i.updateDealer(a.bank_account,a.profile,E)}var z="loading",A="downloaded",B="failed",C="The changes you made will be lost.",D="Saving changes...",E="eprSession",F="dealer_mode",G="viewer_mode",H="/assets/images/icons/@2x/Web_Icons_add_profile_pic_button.png",I="Add Photo",J="Change Photo",K="dealer-pic-uploaded-for-",L="update-as-dealer-for-";a.status=z,a.dealerID=g.dealerID,a.originalDealer={},a.newDealer={},a.bank_account={},a.changedPhoto=!1,a.savedChanges=!1,a.userMode=G,a.photo="",a.photoURL="",a.croppedPhotoURL="",a.editProfilePic=J,a.editingDone=!1,l(),a.showCropDialog=function(){var b=e("xs");d.show({controller:"CropPhotoDialog",templateUrl:"app/components/views/crop-photo-dialog.view.html",parent:angular.element(document.body),fullscreen:b,locals:{rawPhoto:a.photoURL}}).then(function(b){a.croppedPhotoURL=b,u()},function(){u()})},a.openDatepicker=function(b){a.datepicker.opened=!0},a.Date=function(a){return new Date(a)},a.submitEdit=function(b){if(a.userMode==G){if(!v())return}else{if(!w())return;if(!x())return}if(s(),a.changedPhoto){var c=j.dataURItoBlob(a.croppedPhotoURL);k.uploadPhoto(c,E)}else y()},window.onbeforeunload=function(){return C},a.$on("$locationChangeStart",function(b,c){if(!a.editingDone){var d=confirm("Are you sure you want to leave this page? The changes will be lost.");d||b.preventDefault()}}),a.$on("$destroy",function(){window.onbeforeunload=null})}]),angular.module("DealersApp").directive("dlNavbar",["$location","$routeParams","$rootScope","Dealer",function(a,b,c,d){return{restrict:"E",templateUrl:"app/components/views/navbar.view.html",controller:"NavbarController",link:function(a,b){}}}]).directive("dlCategory",function(){return{restrict:"E",replace:!0,scope:{category:"="},template:'<a href="/categories/{{category}}"><li>{{category}}</li></a>'}}).directive("vdInfoPane",function(){return{restrict:"E",replace:!0,templateUrl:"app/components/views/view-deal-info-pane.view.html"}}).directive("dlComment",["DealerPhotos",function(a){return{restrict:"E",replace:!0,scope:{comment:"="},templateUrl:"app/components/views/comment.view.html",link:function(b,c){b.hasProfilePic=a.hasProfilePic(b.comment.dealer.photo);var d="comment";b.hasProfilePic&&(b.commenterPhoto="",a.getPhoto(b.comment.dealer.photo,b.comment.dealer.id,d),b.profilePicStatus="loading"),b.$on("downloaded-"+d+"-dealer-pic-"+b.comment.dealer.id,function(a,c){c.success?(b.commenterPhoto=c.data,b.profilePicStatus="doneLoading",b.$apply()):console.log(c.message)})}}}]);var MAX_PHOTOS=4;angular.module("DealersApp").directive("tabList",function(){return{link:function(a,b){var c=b.children()[0];$(c).on("click",function(c){var d="active";$(b).addClass(d),$(b).siblings().removeClass(d),a.changeDisplay(c.target.innerText)})}}}).directive("carouselItem",function(){return{replace:!0,scope:{photo:"=photoUrl"},templateUrl:"app/components/views/carousel-item.view.html"}}).directive("photoInput",function(){return{scope:{photo:"=",photoURL:"=photoUrl"},link:function(a,b,c){b.bind("change",function(b){var c=b.target.files[0];null!=c&&(a.photo=c,a.photoURL=URL.createObjectURL(c),a.$apply())})}}}).directive("photosInput",function(){return{scope:{photos:"=",photosURLs:"=photosUrls",showAlertDialog:"&"},link:function(a,b,c){b.bind("change",function(b){var c=b.target.files[0];if(!(null==c||a.photos.length>=MAX_PHOTOS)){if($.inArray(c,a.photos)!=-1)return void a.showAlertDialog("Duplicate Photo","This photo was already uploaded.");a.photos.push(c);var d=URL.createObjectURL(c);a.photosURLs.push(d),a.$apply()}})}}}).directive("fileDropzone",function(){return{restrict:"A",scope:{photos:"=",photosURLs:"=photosUrls",showAlertDialog:"&"},link:function(a,b,c){var d,e,f,g;return f=function(a){return null!=a&&(a=a.originalEvent,a.preventDefault()),a.dataTransfer.effectAllowed="copy",!1},g=c.fileDropzone,d=function(a){var b;return void 0===(b=c.maxFileSize)||""===b||a/1024/1024<c.maxFileSize||(alert("File must be smaller than "+c.maxFileSize+" MB"),!1)},e=function(a){return void 0===g||""===g||g.indexOf(a)>-1||(alert("Invalid file type.  File must be one of following types "+g),!1)},b.bind("dragover",f),b.bind("dragenter",f),b.bind("drop",function(b){var c;if(null!=b&&(b=b.originalEvent,b.preventDefault()),c=b.dataTransfer.files[0],null==c||!d(c.size)||!e(c.type))return!1;a.photos.length<MAX_PHOTOS&&($.inArray(c,a.photos)==-1?a.photos.push(c):a.showAlertDialog());var f=URL.createObjectURL(c);return a.photosURLs.push(f),a.$apply(),!1})}}}).directive("googleLocationAutocomplete",[function(){return{scope:{location:"="},link:function(a,b){var c=b[0];c=new google.maps.places.Autocomplete(b[0],{types:["geocode"]}),c.addListener("place_changed",function(){var b=c.getPlace();b&&(a.location=b.formatted_address)}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){var b={lat:a.coords.latitude,lng:a.coords.longitude},d=new google.maps.Circle({center:b,radius:a.coords.accuracy});c.setBounds(d.getBounds())})}}}]),angular.module("DealersApp").controller("HomeController",["$scope","$rootScope","$mdDialog","$mdMedia",function(a,b,c,d){function e(){a.role==b.roles.guest&&(a.gridDescription="See what people are selling with Dealers")}b.dealer?a.role=b.dealer.role:a.role=a.roles.guest,a.isHomePage=!0,a.gridTitle="",a.gridDescription="",a.customFullscreen=d("xs"),e()}]),angular.module("DealersApp").controller("NavbarController",["$scope","$rootScope","$location","$routeParams","$mdMedia","$mdMenu",function(a,b,c,d,e,f){function g(){a.dealer?a.dealer.role==a.roles.admin?a.mode=a.roles.dealer:a.mode=a.dealer.role:a.mode=a.roles.guest}function h(){a.$watch(function(){return e("xs")},function(b){a.phoneMode=b}),a.$watch(function(){return e("sm")},function(b){a.tabletMode=b})}a.dealer=b.dealer,a.searchTerm={},a.catDropdownDisplay=!1,a.mode="",a.phoneMode=!1,a.searchBarPresented=!1,a.customFullscreen=e("xs"),g(),h();var i=c.path().split("/")[1];"search"==i&&(a.searchTerm.text=d.query),a.toggleSearchBar=function(b){a.searchBarPresented=!a.searchBarPresented},a.toggleMenu=function(a,b,c){b?f.hide():a(c)},a.openMenu=function(a,b){a(b)},a.closeMenu=function(a){f.hide()},a.search=function(b){c.path("/search/products/"+a.searchTerm.text)}}]),angular.module("DealersApp").factory("Photos",["$mdMedia",function(a){function b(a){return btoa(String.fromCharCode.apply(null,a.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))}function c(a){for(var b=[],c=0;c<a.length;c++)try{b.push(URL.createObjectURL(a[c]))}catch(a){console.log(a.message)}return b}function d(a){for(var b=atob(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:"image/png"})}function e(a){var b;try{b=URL.createObjectURL(a)}catch(a){return console.log("Not a Blob object:\n"+a.message),!1}if(b.length>0)return!0}function f(a,b,c,e){var f=document.createElement("img");if(m)EXIF.getData(c,function(){var g=.65,i=EXIF.getTag(this,"Orientation");f.onload=function(){var c=h(f),j=c.getContext("2d"),k=c.width*g,m=c.style.width*g,n=c.height*g,o=c.style.height*g;switch(i>4?(c.width=n,c.style.width=o,c.height=k,c.style.height=m):(c.width=k,c.style.width=m,c.height=n,c.style.height=o),i){case 2:j.translate(k,0),j.scale(-1,1);break;case 3:j.translate(k,n),j.rotate(Math.PI);break;case 4:j.translate(0,n),j.scale(1,-1);break;case 5:j.rotate(.5*Math.PI),j.scale(1,-1);break;case 6:j.rotate(.5*Math.PI),j.translate(0,-n);break;case 7:j.rotate(.5*Math.PI),j.translate(k,-n),j.scale(-1,1);break;case 8:j.rotate(-.5*Math.PI),j.translate(-k,0)}j.drawImage(f,0,0,k,n);var p=c.toDataURL("image/jpeg",l.product.quality),q=d(p);e(a,b,q)},f.src=URL.createObjectURL(c)});else{var i=new FileReader;i.onabort=function(){alert("The upload was aborted.")},i.onerror=function(){alert("An error occurred while reading the file.")},i.onload=function(c){f.src=c.target.result;var h;h=d(g(f)),e(a,b,h)},i.readAsDataURL(c)}}function g(a){for(var b=h(a);b.width>=2*l.product.maxWidth;)b=i(b);return b.width>l.product.maxWidth&&(b=j(b)),b.toDataURL("image/jpeg",l.product.quality)}function h(a){var b=document.createElement("canvas");return b.width=a.width,b.height=a.height,b.getContext("2d").drawImage(a,0,0,b.width,b.height),b}function i(a){var b=document.createElement("canvas");return b.width=a.width/2,b.height=a.height/2,b.getContext("2d").drawImage(a,0,0,b.width,b.height),b}function j(a){var b=document.createElement("canvas"),c=l.product.maxWidth/a.width;b.width=a.width*c,b.height=a.height*c;var d=a.getContext("2d").getImageData(0,0,a.width,a.height),e=b.getContext("2d").createImageData(b.width,b.height);return k(d,e,c),b.getContext("2d").putImageData(e,0,0),b}function k(a,b,c){function d(a,b,c,d,e,f){var g=1-e,h=1-f;return a*g*h+b*e*h+c*g*f+d*e*f}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;for(e=0;e<b.height;++e)for(g=e/c,h=Math.floor(g),i=Math.ceil(g)>a.height-1?a.height-1:Math.ceil(g),f=0;f<b.width;++f)j=f/c,k=Math.floor(j),l=Math.ceil(j)>a.width-1?a.width-1:Math.ceil(j),m=4*(f+b.width*e),n=4*(k+a.width*h),o=4*(l+a.width*h),p=4*(k+a.width*i),q=4*(l+a.width*i),r=j-k,s=g-h,t=d(a.data[n],a.data[o],a.data[p],a.data[q],r,s),b.data[m]=t,u=d(a.data[n+1],a.data[o+1],a.data[p+1],a.data[q+1],r,s),b.data[m+1]=u,v=d(a.data[n+2],a.data[o+2],a.data[p+2],a.data[q+2],r,s),b.data[m+2]=v,w=d(a.data[n+3],a.data[o+3],a.data[p+3],a.data[q+3],r,s),b.data[m+3]=w}var l={};l.product={maxWidth:480,quality:.6};var m=a("xs")||a("sm");return l.hexToBase64=b,l.imageDataToUrls=c,l.dataURItoBlob=d,l.checkIfImageData=e,l.preparePhotoForUpload=f,l}]),angular.module("DealersApp").factory("ProductInfo",["$http","$rootScope","Authentication",function(a,b,c){function d(a){return g[a]}function e(){var a=[],b={};return b.store={},b.title="Great product now at Zara with great accessories and stuff",b.price=Number(15),b.currency="DO",b.expiration=new Date,b.store.name="Zara, Raanana",b.photoURL1="jdsfjkdsf;",a.push(b),b={},b.store={},b.title="Wow come see what I found here",b.price=Number(266),b.currency="SH",b.expiration=new Date,b.store.name="Shekem Electric",b.photoURL1="jdsfjkdsf;",b.dealattribs={},b.dealattribs.dealers_that_liked=[2,4,14],a.push(b),b={},b.store={},b.title="1+1 on al hamburgers at McDonalds... Yam Yam!",b.store.name="McDonalds, Kiryat Mozkin Krayot",b.photoURL1="jdsfjkdsf;",a.push(b),b={},b.store={},b.title="Awesome shoes at nike store",b.price=Number(15),b.currency="SH",b.store.name="Nike",b.photoURL1="jdsfjkdsf;",a.push(b),a}var f={},g={USD:"$",ILS:"₪",CNY:"¥",GBP:"£",EUR:"€"};return f.currencyForKey=d,f.getDummyProducts=e,f}]),angular.module("DealersApp").factory("ProductPhotos",["$rootScope","Photos",function(a,b){function c(a){return a.length>2&&"None"!=a}function d(b,c,d){a.s3.getObject({Bucket:a.AWSS3Bucket,Key:b,ResponseContentType:"image/jpg"},function(b,e){var f={};if(f.photoIndex=d,null!=b)f.message="Failed to download photo of product"+c+":\n"+b.message,a.$broadcast("downloaded-photo-"+c,{success:!1,data:f});else{var g=new Blob([e.Body],{type:"image/png"});f.rawImage=g,f.url=URL.createObjectURL(g),a.$broadcast("downloaded-photo-"+c,{success:!0,data:f})}})}function e(a){a.photo1&&d(a.photo1,a.id,1),a.photo2&&d(a.photo2,a.id,2),a.photo3&&d(a.photo3,a.id,3),a.photo4&&d(a.photo4,a.id,4)}function f(b){var c=String(a.dealer.id),d=new Date,e=String(d.getTime()/1e3),f=String(b+1);return c+"_"+e+"_"+f+".png"}function g(a,b,c,d){switch(a){case 0:d.photo1=c+b;break;case 1:d.photo2=c+b;break;case 2:d.photo3=c+b;break;case 3:d.photo4=c+b}}function h(a){return a.photo1&&(a.photo1=""),a.photo2&&(a.photo2=""),a.photo3&&(a.photo3=""),a.photo4&&(a.photo4=""),a}function i(a){var b=0;return a.photo1&&b++,a.photo2&&b++,a.photo3&&b++,a.photo4&&b++,b}function j(a){switch(parseInt(a,10)){case 0:return"rgb(79,195,247)";case 1:return"rgb(129,216,132)";case 2:return"rgb(255,100,105)";case 3:return"rgb(255,212,40)";default:return"rgb(79,195,247)"}}function k(c,d){var e=c.photos;if(q.process.sender=d,q.process.amount=e.length,q.process.product=c,!e)return console.log("The photos array that was sent to the upload function is null!"),void a.$broadcast(p+d,{success:!1,data:"There was a problem, please try again!"});if(0==e.length)return console.log("The photos array that was sent to the upload function is empty!"),void a.$broadcast(p+d,{success:!1,data:"There was a problem, please try again!"});c=h(c);for(var i=l,j=0;j<e.length;j++){var k=f(j);g(j,k,o,c),b.preparePhotoForUpload(j,k,e[j],i)}}function l(b,c,d){var e={Bucket:a.AWSS3Bucket,Key:o+c,Body:d};a.s3.putObject(e,function(c,d){var e=q.process.sender;c?(console.log("There was an error with s3 config: "+c.message),a.$broadcast(p+e,{success:!1,data:c.message})):(b++,console.log("Photo number "+b+" upload complete."),b==q.process.amount&&(a.$broadcast(p+e,{success:!0,data:d,product:q.process.product}),q.process.sender="",q.process.amount=0,q.process.product=null))})}function m(a){var b=[];return a.photo1&&b.push(a.photo1),a.photo2&&b.push(a.photo2),a.photo3&&b.push(a.photo3),a.photo4&&b.push(a.photo4),b}function n(b){for(var c=0;c<b.length;c++){var d={Bucket:a.AWSS3Bucket,Key:o+b[c]};a.s3.deleteObject(d,function(a,b){a?console.log(a,a.stack):console.log("Old photo was deleted successfully!\n"+b)})}}var o="media/Deals_Photos/",p="photos-downloaded-for-",q={};return q.hasPhoto=c,q.downloadPhoto=d,q.downloadPhotos=e,q.photosNum=i,q.colorForNum=j,q.generatePhotoName=f,q.addPhotoUrlToProduct=g,q.uploadPhotosOfProduct=k,q.setProductPhotosInArray=m,q.deletePhotos=n,q.process={},q.process.sender="",q.process.amount=0,q.process.product=null,q}]),angular.module("DealersApp").factory("Product",["$http","$rootScope",function(a,b){function c(c){if(c)return a.get(b.baseUrl+"/alldeals/"+String(c)+"/")}function d(b){return a.get(b)}function e(b){return a.delete(b)}function f(c){return a.post(b.baseUrl+"/transactions/",c)}function g(a){return a.hasOwnProperty("photo1")&&delete a.photo1,a.hasOwnProperty("photo2")&&delete a.photo2,a.hasOwnProperty("photo3")&&delete a.photo3,a.hasOwnProperty("photo4")&&delete a.photo4,a}function h(a){if(a.category){var b=j(a.category);b&&(a.category=b)}return a.currency&&3==a.currency.length&&(a.currency=l(a.currency)),a.discount_type&&2==a.discount_type.length&&(a.discount_type=o(a.discount_type)),a.expiration&&"string"==typeof a.expiration&&(a.expiration=new Date(a.expiration)),a}function i(a){return a.id&&(a.id=parseInt(a.id)),a.dealer&&a.dealer.id&&(a.dealer.id=parseInt(a.dealer.id)),a.price&&(a.price=parseFloat(a.price)),a.percentage_off&&(a.percentage_off=parseFloat(a.percentage_off)),a.original_price&&(a.original_price=parseFloat(a.original_price)),a.max_quantity&&(a.max_quantity=parseInt(a.max_quantity)),a.expiration&&(a.expiration=new Date(a.expiration)),a.upload_date&&(a.upload_date=new Date(a.upload_date)),a.main_photo_width&&(a.main_photo_width=parseInt(a.main_photo_width)),a.main_photo_height&&(a.main_photo_height=parseInt(a.main_photo_height)),a}function j(a){return w[a]}function k(a){for(var b in w)if(w.hasOwnProperty(b)&&w[b]===a)return b}function l(a){return a&&3==a.length?v[a]:a}function m(a){for(var b in v)if(v.hasOwnProperty(b)&&v[b]===a)return b}function n(a){for(var b=0;b<a.length;b++){var c=a[b].currency;a[b].currency=l(c)}return a}function o(a){return"PP"==a?"123":"PE"==a?"%":void 0}function p(a){return"123"==a?"PP":"%"==a?"PE":void 0}function q(a,b){return a.title==b.title&&(a.price==b.price&&(a.currency==b.currency&&(a.discount_value==b.discount_value&&(a.discount_type==b.discount_type&&(a.category==b.category&&(a.expiration==b.expiration&&(a.more_description==b.more_description&&a.more_description==b.more_description)))))))}function r(a){var b=[],c={};for(var d in a)if(a.hasOwnProperty(d)){c.name=a[d].name,c.options=[];for(var e=a[d].options,f=0;f<e.length;f++)c.options.push({option:a[d].options[f]});b.push(c),c={}}return b}function s(a){for(var b={},c={},d=0,e=0;e<a.length;e++){var f=a[e];c.name=f.name,c.options=[];for(var g=0;g<f.options.length;g++)c.options.push(f.options[g].option);b[d]=c,c={},d++}return b}function t(a){var b=$.extend(!0,{},a);return delete b.photos,b}var u={},v={USD:"$",ILS:"₪",CNY:"¥",GBP:"£",EUR:"€"},w={Fa:"Fashion",Au:"Automotive",Ar:"Art",Be:"Health & Beauty",Bo:"Books & Magazines",El:"Electronics",En:"Entertainment & Events",Fo:"Food & Groceries",Ho:"Home & Furniture",Ki:"Kids & Babies",Mu:"Music",Pe:"Pets",Re:"Restaurants & Bars",Se:"Services",Sp:"Sports & Outdoor",Tr:"Travel",Ot:"Other"};return u.getProduct=c,u.getProducts=d,u.deleteProduct=e,u.buyProduct=f,u.removePhotoPaths=g,u.mapData=h,u.unStringifyObject=i,u.categoryForKey=j,u.keyForCategory=k,u.currencyForKey=l,u.keyForCurrency=m,u.convertKeysToCurrencies=n,u.discountTypeForKey=o,u.keyForDiscountType=p,u.areEqual=q,u.parseVariantsToServer=r,u.parseVariantsFromServer=s,u.extractData=t,u}]),angular.module("DealersApp").controller("ProductsGridController",["$scope","$rootScope","$routeParams","ActiveSession","Product","ProductsGrid",function(a,b,c,d,e,f){function g(){if(a.source){if(a.page==p){var b=d.getTempData(n),f=d.getTempData(o);if(l=c.dealerID,b==l&&f)return k="activeSession",m="There are no products.",a.status=r,void i(f)}k="custom",t=a.source,m="There are no products."}else c.query?(k="search",l=c.query,t+="/dealsearch/?search="+l,m="Didn't find any results for '"+l+"'."):c.category?(k="category",l=c.category,t+="/category_deals/?category="+e.keyForCategory(l),m="Currently there are no products in "+l+"...",a.title=l):(k="myFeed",t+="/my_feeds/",m="We couldn't find any products that match your interest :(");a.getProducts()}function h(b){b&&(t=b),e.getProducts(t).then(function(b){a.status=r;var c;b.data.results?c=b.data.results:b.data.uploaded_deals&&(c=b.data.uploaded_deals),a.update.nextPage=b.data.next,i(c),a.update.loadingMore=!1,a.page==p&&(d.setTempData(n,l),d.setTempData(o,c))},function(b){a.status=s,a.message="Couldn't download the products",a.errorPrompt="Please try again...",a.update.loadingMore=!1})}function i(b){j(b),b.length>0?a.products=f.addProductsToArray(a.products,b):a.message=m}function j(a){for(var b=0;b<a.length;b++){var c=a[b];c=e.mapData(c)}}var k,l,m,n="profile_dealer_id",o="profile_products",p="dealer",q="loading",r="downloaded",s="failed",t=b.baseUrl;a.products=[],a.message="",a.status=q,a.update={},a.update.loadingMore=!1,a.update.nextPage="",a.getProducts=h,g()}]),angular.module("DealersApp").factory("ProductsGrid",["$http","$rootScope","Authentication",function(a,b,c){function d(a){for(var b,c=[],d=0;d<a.length;d+=f)b=a.slice(d,d+f),c.push(b);return c}function e(a,b){if(a&&b){if(0==a.length)return d(b);var c=a[a.length-1],e=f-c.length;return Array.prototype.push.apply(c,b.splice(0,e)),b=d(b),Array.prototype.push.apply(a,b),a}}var f=2,g={};return g.divideProductsIntoChunks=d,g.addProductsToArray=e,g}]),angular.module("DealersApp").controller("ProfileController",["$scope","$rootScope","$routeParams","$location","Product","Dealer","DealerPhotos",function(a,b,c,d,e,f,g){function h(b){return a.profile.dealer?(a.downloadDealerStatus=y,void a.setDealerProfile()):void f.getDealer(b).then(function(b){a.profile.dealer=b.data,a.downloadDealerStatus=y,a.setDealerProfile()},function(b){a.message="Couldn't download dealer's information",a.errorPrompt="Please try again..."})}function i(){l(),p(a.profile.dealer.rank),a.getUploadedProducts()}function j(b){b&&(t=b),t+="/uploadeddeals/"+a.profile.dealer.id+"/",e.getProducts(t).then(function(b){a.status=y;var c=b.data.uploaded_deals;k(c),c.length>0?(a.uploadedProducts.push.apply(a.uploadedProducts,c),a.update.nextPage=b.data.next):a.message=q,a.update.loadingMore=!1},function(b){a.status=z,a.message="Couldn't download the products",a.errorPrompt="Please try again...",a.update.loadingMore=!1})}function k(a){for(var b=0;b<a.length;b++){var c=a[b];c=e.mapData(c)}}function l(){a.hasProfilePic=g.hasProfilePic(a.profile.dealer.photo);var b="profile";a.hasProfilePic&&(a.profilePic="",g.getPhoto(a.profile.dealer.photo,a.profile.dealer.id,b),a.profilePicStatus=x),a.$on("downloaded-"+b+"-dealer-pic-"+a.profile.dealer.id,function(b,c){c.success?a.$apply(function(){a.profilePic=c.data,a.profilePicStatus=y}):console.log(c.message)})}function m(){a.settingsDisplay?a.settingsDisplay=!1:a.settingsDisplay=!0}function n(){f.logOut(),d.path("/")}function o(b){a.displayMode=b}function p(b){var c,d;"Viewer"==b?(c=A,d="viewerIcon"):"Dealer"==b?(c=B,d="dealerIcon"):"Pro Dealer"==b?(c=C,d="proDealerIcon"):"Senior Dealer"==b?(c=D,d="seniorDealerIcon"):"Master Dealer"==b&&(c=E,d="masterDealerIcon"),a.rankIcon=c,a.rankClass=d}var q,r=c.dealerID,s=b.baseUrl,t=b.baseUrl,u="guestMode",v="myProfile",w="otherProfile",x="loading",y="downloaded",z="failed",A="../../../../assets/images/icons/@2x/Web_Icons_viewer_icon.png",B="../../../../assets/images/icons/@2x/Web_Icons_dealer_icon.png",C="../../../../assets/images/icons/@2x/Web_Icons_pro_dealer_icon.png",D="../../../../assets/images/icons/@2x/Web_Icons_senior_dealer_icon.png",E="../../../../assets/images/icons/@2x/Web_Icons_master_dealer_icon.png";a.profile={dealer:null},a.uploadedProducts=[],a.profileMode="",a.displayModes={myProducts:"MY PRODUCTS",purchases:"SALES",orders:"ORDERS"},a.message="",a.status=x,a.downloadDealerStatus=x,a.settings=["Log Out"],a.settingsDisplay=!1,a.source=b.baseUrl+"/uploadeddeals/"+r+"/",a.page="profile",a.products=[],a.settingsToggle=m,a.logOut=n,a.update={},a.update.loadingMore=!1,a.update.nextPage="",a.getDealer=h,a.setDealerProfile=i,a.getUploadedProducts=j,a.changeDisplay=o,b.dealer?parseInt(r)==b.dealer.id?(a.profileMode=v,a.profile.dealer=b.dealer,a.profile.dealer.role==b.roles.viewer?a.displayMode=a.displayModes.orders:a.displayMode=a.displayModes.myProducts):(a.profileMode=w,a.displayMode=a.displayModes.myProducts):a.profileMode=u,s+="/dealers/"+r,a.getDealer(r),a.openMenu=function(a,b){a(b)},a.editProfile=function(a){d.path("/edit-profile/"+r)}}]),angular.module("DealersApp").controller("PurchaseDetailsController",["$scope","$rootScope","$routeParams","$location","$mdDialog","$mdMedia","ActiveSession","Purchase","Product","Dealer",function(a,b,c,d,e,f,g,h,i,j){function k(){a.status=p,a.screenIsSmall=f("xs"),a.purchase=g.getTempData(r),a.isDealer=!1,a.purchase?(a.status=o,m()):l()}function l(){var b=c.purchaseID;h.getPurchase(b).then(function(b){a.status=o,a.purchase=b.data,m()},function(b){a.status=q,a.errorMessage="Couldn't download the purchase object.",a.errorPrompt="Please try again..."})}function m(){a.shipping_address=a.purchase.shipping_address,a.purchase.buyer.id||j.getShortDealer(a.purchase.buyer).then(function(b){a.purchase.buyer=b.data},function(a){console.log("Couldn't download the buyer's name and photo.")});var c=a.purchase.dealer.id?a.purchase.dealer.id:a.purchase.dealer;a.isDealer=c==b.dealer.id;var d=a.purchase.currency;a.purchase.currency=i.currencyForKey(d),n(a.purchase.deal.id?a.purchase.deal.id:a.purchase.deal)}function n(b){i.getProduct(b).then(function(b){a.product=b.data,a.product=i.mapData(a.product)},function(b){a.status=q,a.errorMessage="Couldn't download the product",
a.errorPrompt="Please try again..."})}var o="downloaded",p="downloading",q="failed",r="PURCHASE";k(),a.markButtonTitle=function(b){return b?a.isDealer?b.status==h.SENT_STATUS?"Marked as sent":b.status==h.RECEIVED_STATUS?"Received!":"Mark as sent":b.status==h.RECEIVED_STATUS?"Marked as received":"Mark as received":""},a.$on("$destroy",function(){g.removeTempData(r)})}]),angular.module("DealersApp").factory("Purchase",["$http","$rootScope","Product","Analytics",function(a,b,c,d){function e(b){return a.get(m+b+"/")}function f(b){return a.get(n+b+"/")}function g(b){return a.get(l+b+"/")}function h(b,c){b.purchase_date=new Date,a.post(l,b).then(function(a){console.log("Purchase saved."),b=a.data,d.addTrans(String(b.id),String(b.dealer),String(b.amount*b.quantity/100),"","","","","",b.currency),d.addItem(String(b.id),"",c.title,c.category,String(b.amount/100),String(b.quantity))},function(a){console.log("Couldn't save the purchase data.")})}function i(b,c){return b==o.SENT_STATUS&&c.status==o.PURCHASED_STATUS?c.send_date=new Date:b==o.RECEIVED_STATUS&&c.status==o.SENT_STATUS?c.receive_date=new Date:b==o.PURCHASED_STATUS&&c.status==o.SENT_STATUS?(c.send_date=null,c.estimated_delivery_time=null):b==o.SENT_STATUS&&c.status==o.RECEIVED_STATUS&&(c.receive_date=null),c.status=b,c=j(c),a.patch(l+c.id+"/",c)}function j(a){return a.currency=c.keyForCurrency(a.currency),a.dealer.id&&(a.dealer=a.dealer.id),a.deal.id&&(a.deal=a.deal.id),a.buyer.id&&(a.buyer=a.buyer.id),a}function k(b,c){if(b>=0){var d={estimated_delivery_time:b};return a.patch(l+c.id+"/",d)}console.log("Invalid estimated delivery time value.")}var l=b.baseUrl+"/purchases/",m=b.baseUrl+"/orders/",n=b.baseUrl+"/sales/",o={};return o.PURCHASED_STATUS="Purchased",o.SENT_STATUS="Sent",o.RECEIVED_STATUS="Received",o.getOrders=e,o.getSales=f,o.getPurchase=g,o.addPurchase=h,o.updatePurchase=i,o.updateEstimatedDeliveryTime=k,o}]),angular.module("DealersApp").directive("updateStatusBuyer",["$mdDialog","Purchase","Dialogs","Product",function(a,b,c,d){return{link:function(e){function f(a,c){var d=$.extend(!0,{},c);b.updatePurchase(a,c).then(function(a){e.purchase=a.data,g(d)},function(a){console.log("Couldn't update the status of the purchase :(")})}function g(a){e.purchase.currency=d.currencyForKey(e.purchase.currency),a.deal.id&&(e.purchase.deal=a.deal),a.buyer.id&&(e.purchase.buyer=a.buyer),a.dealer.id&&(e.purchase.dealer=a.dealer)}e.changeStatus=function(d,e){var g;e.status==b.SENT_STATUS||e.status==b.PURCHASED_STATUS?(g=c.confirmDialog("Mark this order as 'Received'","Did you receive this product?","Yes",d),a.show(g).then(function(){f(b.RECEIVED_STATUS,e)})):e.status==b.RECEIVED_STATUS&&(g=c.confirmDialog("Mark this order as 'Sent' again","Didn't you receive this product?","No, I didn't",d),a.show(g).then(function(){f(b.SENT_STATUS,e)}))}}}}]).directive("updateStatusDealer",["$mdDialog","Purchase","Dialogs","Product",function(a,b,c,d){return{link:function(e){function f(b){a.show(a.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("You didn't specified a valid estimated delivery time.").textContent("This is required so the customer will know how long to wait for his order.").ariaLabel("Alert Dialog").ok("Got it").targetEvent(b))}function g(b,c,d,e,f){return a.prompt().title(b).textContent(c).placeholder(d).ariaLabel("Estimated Delivery Time").targetEvent(f).ok(e).cancel("Cancel")}function h(a,c){var d=$.extend(!0,{},c);b.updatePurchase(a,c).then(function(a){e.purchase=a.data,i(d)},function(a){console.log("Couldn't update the status of the purchase :(")})}function i(a){e.purchase.currency=d.currencyForKey(e.purchase.currency),a.deal.id&&(e.purchase.deal=a.deal),a.buyer.id&&(e.purchase.buyer=a.buyer),a.dealer.id&&(e.purchase.dealer=a.dealer)}e.changeStatus=function(d,e){var i;e.status==b.PURCHASED_STATUS?(i=g("Mark this order as 'Sent'","What is the estimated delivery time (days)?","e.g. 30","OK",d),a.show(i).then(function(a){if(a&&a.length>0){var c=parseInt(a,10);if(c>0)return e.estimated_delivery_time=c,void h(b.SENT_STATUS,e)}f(d)})):e.status==b.SENT_STATUS&&(i=c.confirmDialog("Mark this order as 'Purchased' again","Didn't you send this product?","No, I didn't",d),a.show(i).then(function(){h(b.PURCHASED_STATUS,e)}))}}}}]).directive("ordersList",function(){return{restrict:"E",replace:!0,scope:{},templateUrl:"app/components/views/purchases/orders-list.view.html",controller:["$scope","$rootScope","$location","$mdDialog","ActiveSession","Purchase","Product",function(a,b,c,d,e,f,g){function h(){f.getOrders(b.dealer.id).then(function(b){a.purchases=b.data.buyer_purchases,a.purchases=g.convertKeysToCurrencies(a.purchases),a.loadingStatus=j},function(a){console.log("Couldn't download the orders of this user :(")})}var i="loading",j="downloaded";a.loadingStatus=i,h(),a.markButtonTitle=function(a){return a.status==f.RECEIVED_STATUS?"Marked as received":"Mark as received"},a.purchaseDetails=function(a,b){e.setTempData("PURCHASE",a),c.path("/purchase/"+a.id)}}]}}).directive("salesList",function(){return{restrict:"E",replace:!0,scope:{},templateUrl:"app/components/views/purchases/sales-list.view.html",controller:["$scope","$rootScope","$location","$mdDialog","ActiveSession","Purchase","Product",function(a,b,c,d,e,f,g){function h(){f.getSales(b.dealer.id).then(function(b){a.purchases=b.data.dealer_purchases,a.purchases=g.convertKeysToCurrencies(a.purchases),a.loadingStatus=j},function(b){console.log("Couldn't download the orders of this user :("),a.loadingStatus=j})}var i="loading",j="downloaded";a.loadingStatus=i,h(),a.markButtonTitle=function(a){return a.status==f.SENT_STATUS?"Marked as sent":a.status==f.RECEIVED_STATUS?"Received!":"Mark as sent"},a.purchaseDetails=function(a,b){e.setTempData("PURCHASE",a),c.path("/purchase/"+a.id)}}]}}),angular.module("DealersApp").controller("RegisterAsDealerController",["$scope","$rootScope","$location","$mdDialog","$mdMedia","Dealer","DealerPhotos","Photos",function(a,b,c,d,e,f,g,h){function i(b){return a.croppedPhotoURL==w?(l("Profile Photo Missing","You forgot to add a photo!",b),!1):a.dealer.about?!!a.dealer.location||(l("Location field is blank","This field is required.",b),!1):(l("About field is blank","This field is required.",b),!1)}function j(b){return a.bank_account.account_number?a.bank_account.branch_number?a.bank_account.bank?!!a.bank_account.account_holder||(l("Account holder name is blank","This field is required.",b),!1):(l("The bank field is blank","This field is required.",b),!1):(l("Branch number is blank","This field is required.",b),!1):(l("Account number is blank","This field is required.",b),!1)}function k(){a.$on(x+p,function(c,d){d.success?(b.userProfilePic=a.croppedPhotoURL,f.registerDealer(a.bank_account,p)):(n(c),console.log("Couldn't upload the dealer pic. Aborting upload process."))}),a.$on(y+p,function(b,d){d.success?(console.log("Dealer is registered successfully!"),window.onbeforeunload=null,a.registrationDone=!0,n(),c.path("/done-registration")):(n(b),d.message.data&&d.message.data.account_number[0]?l("Account number duplicate","The account number you entered already exists. Please check your input again.",b):l("There was a problem...","We're sorry, please try again!",b))}),a.$watch("photoURL",function(){a.photoURL&&a.photoURL.length>0&&a.showCropDialog()}),a.$watch("croppedPhotoURL",function(){a.croppedPhotoURL==w?a.editProfilePic=u:a.editProfilePic=v}),a.$watch(function(){return e("xs")})}function l(a,b,c){d.show(d.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a).textContent(b).ariaLabel("Alert Dialog").ok("Got it").targetEvent(c))}function m(a){d.show({templateUrl:"app/components/views/loading-dialog.view.html",parent:angular.element(document.body),targetEvent:a,controller:"LoadingDialogController",locals:{message:z},escapeToClose:!1})}function n(a){d.hide()}function o(){a.photo="",a.photoURL=""}var p="register-as-dealer-session",q=0,r=1,s="Next",t="Done!",u="Add Photo",v="Change Photo",w="/assets/images/icons/@2x/Web_Icons_add_profile_pic_button.png",x="dealer-pic-uploaded-for-",y="register-as-dealer-for-",z="Uploading...",A="The content will be lost.";a.photo="",a.photoURL="",a.croppedPhotoURL=w,a.editProfilePic=u,a.submitButtonTitle=s,a.registrationDone=!1,a.dealer=b.dealer,a.bank_account={},k(),a.onTabSelected=function(b){0==b?a.submitButtonTitle=s:a.submitButtonTitle=t},a.showCropDialog=function(){var b=e("xs");d.show({controller:"CropPhotoDialog",templateUrl:"app/components/views/crop-photo-dialog.view.html",parent:angular.element(document.body),fullscreen:b,locals:{rawPhoto:a.photoURL}}).then(function(b){a.croppedPhotoURL=b,o()},function(){o()})},a.register=function(b){if(a.selectedTab==q)return void(a.selectedTab=r);if(i()&&j()){a.bank_account.dealer=a.dealer.id,m();var c=h.dataURItoBlob(a.croppedPhotoURL);g.uploadPhoto(c,p)}},window.onbeforeunload=function(){return A},a.$on("$locationChangeStart",function(b,c){if(!a.registrationDone){var d=confirm("Are you sure you want to leave this page? This process will be lost.");d||b.preventDefault()}}),a.$on("$destroy",function(){window.onbeforeunload=null})}]),angular.module("DealersApp").factory("RootDealerReady",["$q",function(a){var b=a.defer(),c={};return c.setAsReady=function(a){b.resolve(a)},c.whenReady=function(){return b.promise},c}]),angular.module("DealersApp").controller("SignInDialogController",["$scope","$rootScope","$mdDialog","Dealer","tab",function(a,b,c,d,e){function f(b){a.selectedTab==i?a.buttonTitle=j:a.buttonTitle=k,a.errorMessage=b,a.showError=!0}function g(){a.selectedTab==i?a.buttonTitle=j:a.buttonTitle=k,a.errorMessage="",a.showError=!1}function h(){a.$on("sign-up",function(a,b){if(b.success)console.log("User has signed up successfully!");else{var c=b.message.data;f(c.detail?c.detail:c.user[0].username[0]?c.user[0].username[0]:c)}}),a.$on("log-in",function(a,b){if(b.success)console.log("User has logged in successfully!");else{var c=b.message.data.detail;f(c)}}),a.$on("credentials-set",function(b,c){c.success?(g(),a.enter()):(console.log("Couldn't get token: "+String(c.message)),f("There was a problem. Please try again"))})}var i=0,j="Sign Up!",k="Log In";a.selectedTab=e,a.datepicker={opened:!1,options:{formatYear:"yyyy",maxDate:new Date,showWeeks:!1}},a.maxDate=new Date,a.logIn={},a.dealer={full_name:"",email:"",user:{username:"",password:""},date_of_birth:null,gender:"",register_date:null,role:"Viewer"},g(),h(),a.signUp=function(b){if(!b.$valid)return void f("Not all fields are valid!");a.showError=!1,a.buttonTitle="Loading...";var c=a.dealer,e=c.email;e>30?c.user.username=e.substring(0,30):c.user.username=e,c.gender||(c.gender="Unspecified"),c.bank_accounts=[],c.credit_cards=[],c.register_date=new Date,d.create(c)},a.logIn=function(b){return b.$valid?(a.showError=!1,a.buttonTitle="Loading...",void d.logIn(a.logIn.email,a.logIn.password)):void f(b.email.$viewValue&&""!==b.email.$viewValue?b.email.$invalid?"The email you entered is not valid":b.password.$viewValue&&""!==b.password.$viewValue?"There are unvalid fields!":"Please enter your password!":"Please enter your email!")},a.submit=function(b,c,d){a.selectedTab==i?a.signUp(c):a.logIn(d)},a.onTabSelected=function(b){b==i?a.buttonTitle=j:a.buttonTitle=k},a.openDatepicker=function(b){a.datepicker.opened=!0},a.enter=function(){b.setUserProfilePic(),d.setIntercom(b.dealer),a.hide()},a.hide=function(){c.hide()},a.cancel=function(){c.cancel()}}]),angular.module("DealersApp").controller("ViewDealController",["$scope","$rootScope","$http","$routeParams","$route","$location","$timeout","$mdDialog","$mdMedia","Product","ProductPhotos","DealerPhotos","ActiveSession","EditProduct","Dialogs","Checkout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){var b=d.productID;j.getProduct(b).then(function(b){a.status="downloaded",a.product=b.data,a.product=j.mapData(a.product),m.shouldRunAction(D)&&B(),r()},function(b){a.status="failed",a.errorMessage="Couldn't download the product",a.errorPrompt="Please try again..."})}function r(){s(),w(),a.firstPhotoHeight=a.product.main_photo_height,a.variants=j.parseVariantsFromServer(a.product.variants),a.totalLikes=a.product.dealattribs.dealers_that_liked.length,a.user&&(a.product.comments.length>1?a.commentPlaceholder="Add a comment...":a.commentPlaceholder="Be the first to comment...")}function s(){k.downloadPhotos(a.product);for(var c=0;c<k.photosNum(a.product);c++)a.productPhotosStatus.push("loading"),a.photosURLs.push(b.DEFAULT_PRODUCT_PHOTO_URL);a.$on("downloaded-photo-"+a.product.id,function(b,c){var d=c.data,e=d.photoIndex-1;c.success?(a.photosURLs[e]=d.url,a.productPhotosStatus[e]="doneLoading",a.firstPhotoSelected||(a.selectPhoto(0),a.firstPhotoSelected=!0),a.$apply()):(console.log("Photos number "+d.photoIndex+" failed to download: \n"+d.message),a.productPhotosStatus[e]="failed")})}function t(b){a.selectedIndex=b,a.changeThumbnailSelection(b),g(function(){$(".carousel-inner div").each(function(b){a.selectedIndex==b?$(this).addClass("active"):$(this).removeClass("active")})},100)}function u(a){var b=$("div.carousel-inner"),c=b.children();return $(c[a]).hasClass("active")}function v(a){$("button.ap-thumbnail").removeClass("selected"),$("li#"+a+" button.ap-thumbnail").addClass("selected")}function w(){var b=a.product.dealer.photo,c="view-deal";a.hasProfilePic=l.hasProfilePic(b),a.hasProfilePic&&(a.profilePic="",l.getPhoto(b,a.product.dealer.id,c),a.profilePicStatus="loading"),a.$on("downloaded-"+c+"-dealer-pic-"+a.product.dealer.id,function(b,c){c.success?(a.profilePic=c.data,a.profilePicStatus="doneLoading"):(console.log(c.message),a.profilePicStatus="failed")})}function x(d){if(d.$valid){var e=a.comment;e.upload_date=new Date,e.product=a.product.id,e.dealer=b.dealer.id,e.type="Deal",a.showCommentError=!1,c.post(b.baseUrl+"/addcomments/",e).then(function(c){console.log("Comment uploaded successfully!"),e=c.data,e.dealer=b.dealer,a.product.comments.push(e),a.comment={}},function(b){console.log(b.status+" : "+b.data),a.showCommmentError=!0,a.presentCommentError("There was an error, please try again")})}else a.presentCommentError()}function y(b){b?a.commentErrorMessage=b:a.commentErrorMessage="There was an error, please try again",a.showCommentError=!0}function z(a,b,c){h.show(h.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(a).textContent(b).ariaLabel("Alert Dialog").ok("Got it").targetEvent(c))}function A(){if(!b.dealer)return o.showSignInDialog(event,0).then(function(a){m.addActionToRun(D),e.reload()}),!1;for(var c in a.variants)if(a.variants.hasOwnProperty(c)){var d=a.variants[c];if(!d.selection)return z("","Please select a "+d.name.toLowerCase()+"."),!1;a.purchase.selections.push({name:d.name,selection:d.selection})}return a.purchase.quantity>0?a.purchase.quantity>a.product.max_quantity?(z("","The maximum quantity for order is "+a.product.max_quantity+"."),!1):(a.purchase.quantity=Math.round(a.purchase.quantity),!0):(z("","Please select a valid quantity."),!1)}function B(){if(A()){a.product.photo=a.photosURLs?a.photosURLs[0]:null,m.setTempData(E,a.product),p.purchase=a.purchase,a.movedToCheckout=!0;var b="/products/"+a.product.id+"/checkout";f.path(b)}}var C=b.baseUrl+"/alldeals/"+d.productID+"/",D=(b.baseUrl+"/products/","buyClicked"),E="PRODUCT";a.product={},a.status="loading",a.productPhotosStatus=[],a.photosURLs=[],a.profilePicStatus="loading",a.hasProfilePic=!1,a.variants=[],a.purchase={selections:[],quantity:1},a.user=b.dealer,a.totalLikes=0,a.firstPhotoSelected=!1,a.movedToCheckout=!1,a.commentPlaceholder="",a.comment={},a.showCommentError=!1,a.commentErrorMessage="Oops! Comment can't be blank!",a.showCommentButton=!1,a.selectPhoto=t,a.changeThumbnailSelection=v,a.checkIfActive=u,a.addComment=x,a.presentCommentError=y,a.proceedToCheckout=B,a.showAlertDialog=z,a.$watch(function(){return i("gt-sm")},function(b){a.bigScreen=b}),a.product=m.getTempData(E),a.product?a.product.id!=d.productID?q():(a.status="downloaded",m.shouldRunAction(D)&&B(),r()):q(),a.nextPhoto=function(b){var c;c="A"==b.target.tagName?b.target:b.target.parentElement;var d,e=a.photosURLs.length;a.checkIfActive(a.selectedIndex)&&($(c).hasClass("left")?(d=a.selectedIndex-1,d<0&&(d=e-1)):$(c).hasClass("right")&&(d=a.selectedIndex+1,d>=e&&(d=0)),a.selectedIndex=d,a.changeThumbnailSelection(d))},a.$watchGroup(["photos[0]","photos[1]","photos[2]","photos[3]"],function(b,c){for(var d=0;d<b.length;d++)null!=b[d]&&null==c[d]&&a.selectPhoto(d)}),a.canEdit=function(){return!(!a.user||a.product.dealer.id!=b.dealer.id)},a.editProduct=function(){a.canEdit()&&(n.product=a.product,f.path("edit-product/"+a.product.id))},a.openMenu=function(a,b){a(b)},a.report=function(a){console.log("Report!")},a.deleteProduct=function(a){var c=h.confirm().title("Delete Product").textContent("Are you absolutely sure that you want to delete this product? It cannot be undone!").ariaLabel("Delete product").targetEvent(a).ok("Yes, delete this product").cancel("Cancel");h.show(c).then(function(){j.deleteProduct(C).then(function(a){console.log("Product deleted successfully."),g(b.showToast,1e3,!0,"Deleted the product."),f.path("/home")},function(a){console.log(a.status+" : "+a.data),h.show(h.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("Couldn't delete the product").textContent("Please try again!").ariaLabel("Alert Dialog").ok("OK").targetEvent(ev))})})},a.$on("$destroy",function(){a.movedToCheckout||m.removeTempData(E)})}]),angular.module("DealersApp").directive("likeButton",["$rootScope","$http","$route","Product","Dialogs","ActiveSession","Analytics",function(a,b,c,d,e,f,g){return{link:function(d,h){function i(){var a=$.inArray(n,m);return a!=-1}function j(){i()?(d.likeStatus="LIKED",$(h).css("color","#9C27B0").find("span").replaceWith("<span> Liked<span>")):(d.likeStatus="LIKE",$(h).css("color","#313140").find("span").replaceWith("<span> Like<span>"))}function k(h){if(!n)return void e.showSignInDialog(h,0).then(function(a){f.addActionToRun(l),c.reload()});if(i()){var k=m.indexOf(n);k>-1&&m.splice(k,1)}else g.trackEvent("Product","like",String(d.product.id)),m.push(n);b.patch(a.baseUrl+"/dealattribs/"+d.product.dealattribs.id+"/",d.product.dealattribs).then(function(a){d.product.dealattribs=a.data,j()},function(a){console.log(a.status+" : "+a.data)})}var l="likeClicked";if(!d.product)return void console.log("There's a problem - the parent scope doesn't have a product attribute.");var m=d.product.dealattribs.dealers_that_liked;if(a.dealer){var n=a.dealer.id;j()}d.likeClicked=k,f.shouldRunAction(l)&&d.likeClicked()}}}]).directive("shareButton",["$rootScope","Analytics",function(a,b){return{link:function(c,d){$(d).on("click",function(d){b.trackEvent("Product","share",String(c.product.id));var e=a.homeUrl+"/products/"+c.product.id;FB.ui({method:"share",mobile_iframe:!0,href:e},function(a){})})}}}]).directive("registerAsDealer",["$rootScope","$location","$mdMedia","$mdDialog",function(a,b,c,d){return{link:function(e,f){e.customFullscreen=c("xs"),e.showSignInDialog=function(a,c,f){d.show({controller:"SignInDialogController",templateUrl:"app/components/views/sign-in/sign-in-dealer-dialog.view.html",parent:angular.element(document.body),targetEvent:a,fullscreen:e.customFullscreen,locals:{tab:c}}).then(function(a){f?b.path("/register"):b.path("/home")})},$(f).on("click",function(c){a.dealer?(b.path("/register"),e.$apply()):$(f).is("#nav-login")?e.showSignInDialog(c,1,!1):e.showSignInDialog(c,0,!0)})}}}]).directive("loadingSpinner",function(){return{restrict:"E",scope:{size:"@"},template:"<div class='spinnerContainer'></div>",link:function(a,b){var c=b[0].children[0],d=.25;"small"===a.size&&(d=.16);var e={lines:13,length:28,width:14,radius:42,scale:d,corners:1,color:"rgb(100,100,115)",opacity:.25,rotate:0,direction:1,speed:1.2,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};new Spinner(e).spin(c)}}}).directive("scrollDetector",["Product",function(a){return{link:function(a,b){$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-700&&(a.update.loadingMore||a.update.nextPage&&(console.log("Loading more products"),a.update.loadingMore=!0,a.$apply(),a.getProducts(a.update.nextPage)))}),a.$on("$destroy",function(){$(window).off("scroll")})}}}]);