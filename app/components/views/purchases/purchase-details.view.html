<dl-navbar></dl-navbar>

<div class="container nav-padding" ng-cloak>
    <div class="framed-container container-padding purchase-details" ng-switch on="status">
        <div ng-switch-when="downloading">
            <loading-spinner></loading-spinner>
        </div>
        <div ng-switch-when="failed">
            <h1 class="dl-download-error">{{errorMessage}} <br> {{errorPrompt}} </h1>
        </div>
        <div ng-switch-when="downloaded" layout="column">
            <h2>Purchase Details</h2>
            <div layout="row" layout-xs="column">
                <div class="pd-purchase-details margin-bottom-30" flex flex-xs="60">
                    <div class="margin-bottom-30">
                        <ul>
                            <li class="purchase-amount">{{purchase.amount / 100 * purchase.quantity |
                                currency:purchase.currency}}
                            </li>
                            <li ng-repeat="selection in purchase.selections">
                                {{selection.name}}: <b>{{selection.selection}}</b>
                            </li>
                            <li>Qty: <b>{{purchase.quantity}}</b> <span ng-show="purchase.quantity > 1"><b>({{purchase.amount / 100 | currency: purchase.currency}} each)</b></span>
                            </li>
                            <li>Status: <b>{{purchase.status}}</b></li>
                            <li>Purchase Date: <b>{{purchase.purchase_date | date: 'short'}}</b></li>
                            <li ng-show="purchase.send_date != null">Send Date: <b>{{purchase.send_date | date:
                                'short'}}</b></li>
                            <li ng-show="purchase.receive_date != null">Receive Date: <b>{{purchase.receive_date | date:
                                'short'}}</b></li>
                            <li ng-show="purchase.estimated_delivery_time > 0">ETD: <b>{{purchase.estimated_delivery_time}}
                                days</b>
                            </li>
                            <li>
                                Bought by: <a
                                    ng-href="/dealers/{{purchase.buyer.id}}"><b>{{purchase.buyer.full_name}}</b></a>
                            </li>
                        </ul>
                    </div>
                    <div class="margin-bottom-30">
                        <h4>Shipping Address</h4>
                        <ul>
                            <li>Address: <b>{{shipping_address.st_address}}</b></li>
                            <li>City: <b>{{shipping_address.city}}</b></li>
                            <li ng-show="shipping_address.state.length > 0">State: <b>{{shipping_address.state}}</b>
                            </li>
                            <li>Country: <b>{{shipping_address.country}}</b></li>
                            <li ng-show="shipping_address.zip.length > 0">ZIP: <b>{{shipping_address.zip}}</b></li>
                        </ul>
                    </div>
                    <div class="margin-bottom-30">
                        <h4>Delivery</h4>
                        <div class="loadingSpinner" ng-hide="downloadedDelivery">
                            <loading-spinner size="small"></loading-spinner>
                        </div>
                        <ul ng-show="downloadedDelivery">
                            <li>Title: <b>{{delivery.title}}</b></li>
                            <li>
                                Shipping Price:
                                <span ng-show="delivery.shipping_price == 0">
                                        <b>Free</b>
                                    </span>
                                <span ng-hide="delivery.shipping_price == 0" class="purchase-amount">
                                        {{delivery.shipping_price | currency: purchase.currency}}
                                    </span>
                            </li>
                            <li ng-show="delivery.estimated_delivery_time">ETD:
                                <b>{{delivery.estimated_delivery_time}}</b></li>
                        </ul>
                    </div>
                    <div class="margin-bottom-30" ng-show="downloadedDelivery">
                        <h4>Total Price</h4>
                        <total-price-calculator present="downloadedDelivery" purchase="purchase"
                                                delivery="delivery"></total-price-calculator>
                    </div>
                    <div class="margin-bottom-30">
                        <h4>Status</h4>
                        <md-button ng-show="isDealer" class="md-button md-btn-small btn-background"
                                   ng-class="{'received': purchase.status == 'Sent'}"
                                   ng-click="changeStatus($event, purchase)" update-status-dealer
                                   ng-disabled="purchase.status == 'Received'">
                            {{markButtonTitle(purchase)}}
                        </md-button>
                        <md-button ng-hide="isDealer" class="md-button md-btn-small btn-background"
                                   ng-class="{'received': purchase.status == 'Received'}"
                                   ng-click="changeStatus($event, purchase)" update-status-buyer>
                            {{markButtonTitle(purchase)}}
                        </md-button>
                    </div>
                </div>
                <div flex flex-xs="40">
                    <dl-product ng-if="product" product="product"></dl-product>
                </div>
            </div>
        </div>
    </div>
</div>

<footer-section></footer-section>